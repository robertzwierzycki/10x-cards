---
/**
 * Protected Layout
 * Layout for authenticated pages with user session
 */
import Layout from "./Layout.astro";
import { Header } from "@/components/navigation/Header";
import { Toaster } from "sonner";

interface Props {
  title?: string;
}

const { title = "10xCards" } = Astro.props;

// Verify user is authenticated
const user = Astro.locals.user;

if (!user) {
  return Astro.redirect("/login?redirectTo=" + encodeURIComponent(Astro.url.pathname));
}

// Get current path for active nav state
const currentPath = Astro.url.pathname;
---

<Layout title={title}>
  <Header userEmail={user.email} currentPath={currentPath} client:load />
  <main class="min-h-screen bg-background">
    <slot />
  </main>
  <Toaster client:load richColors position="top-right" />
</Layout>
